#!/usr/bin/env node
/**
 * Code Review Skill Stop Hook
 *
 * ì½”ë“œ ë¦¬ë·° ì™„ë£Œ í›„ ë‹¤ìŒ ë‹¨ê³„ ì•ˆë‚´
 *
 * @version 1.4.4
 */

const path = require('path');

// Load common utilities
let common;
try {
  common = require(path.join(__dirname, '..', 'lib', 'common.js'));
} catch (e) {
  console.error('[code-review-stop] Failed to load common.js:', e.message);
  process.exit(0);
}

async function main() {
  try {
    common.debugLog('CodeReviewStop', 'Hook triggered');

    // Get current PDCA status
    const pdcaStatus = common.getPdcaStatusFull();
    const currentFeature = pdcaStatus?.currentFeature;
    const currentPhase = pdcaStatus?.features?.[currentFeature]?.phase;

    // Suggest next steps based on context
    let suggestion = '';

    if (currentPhase === 'do') {
      suggestion = `
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ’¡ Code Review ì™„ë£Œ - ë‹¤ìŒ ë‹¨ê³„ ì•ˆë‚´
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì½”ë“œ ë¦¬ë·°ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.

ì¶”ì²œ ë‹¤ìŒ ë‹¨ê³„:
1. ë°œê²¬ëœ ì´ìŠˆ ìˆ˜ì •
2. Gap ë¶„ì„ ì‹¤í–‰: /pdca analyze ${currentFeature || '[feature]'}
3. ë˜ëŠ” ì¶”ê°€ ë¦¬ë·° ìš”ì²­

ğŸ”„ ì´ìŠˆ ìˆ˜ì • í›„ ë‹¤ì‹œ ë¦¬ë·°í•˜ë ¤ë©´: /code-review [path]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`;
    } else if (currentPhase === 'check') {
      suggestion = `
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ’¡ Code Review ì™„ë£Œ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Check ë‹¨ê³„ ì½”ë“œ ë¦¬ë·°ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.

ë§¤ì¹˜ìœ¨ì— ë”°ë¥¸ ë‹¤ìŒ ë‹¨ê³„:
- 90% ë¯¸ë§Œ: /pdca iterate ${currentFeature || '[feature]'}
- 90% ì´ìƒ: /pdca report ${currentFeature || '[feature]'}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`;
    } else {
      suggestion = `
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ’¡ Code Review ì™„ë£Œ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì½”ë“œ ë¦¬ë·°ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
ë°œê²¬ëœ ì´ìŠˆë¥¼ ê²€í† í•˜ê³  í•„ìš”í•œ ìˆ˜ì •ì„ ì§„í–‰í•˜ì„¸ìš”.
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`;
    }

    console.log(suggestion);

  } catch (error) {
    common.debugLog('CodeReviewStop', 'Error in hook', { error: error.message });
  }
}

main();
